# mysql架构

- 服务层

  - ​     连接：  建立连接、获取权限、管理连接

    ​     长连接的缺点如何避免？

    ​     mysql执行过程临时使用的内存是管理在连接对象中，这些资源会在连接断开时才释放，长期积累下来，内存过大；解决措施：1、定期断开长连接  2、如果你用的是 MySQL 5.7 或更新版本，可以在每次执行一个比较大的操作后，通过执行
    mysql_reset_connection 来重新初始化连接资源。这个过程不需要重连和重新做权限验
      证，但是会将连接恢复到刚刚创建完时的状态。

  - ​     分析：  sql语句词法和语法分析

  - ​     缓存 ：以键值对的方式缓存查询结果，key为查询语句，value为查询结果，命中直接返回

  - ​     优化：对需要的sql语句进行优化，例如选择那个索引及其连表顺序，制定执行计划

  - ​     执行：首先会检查连接是否有这些表的执行权限，然后会根据执行方案使用存储引擎的接口来执行。

       比如我们这个例子中的表 T 中，ID 字段没有索引，那么执行器的执行流程是这样的：

    1. 调用 InnoDB 引擎接口取这个表的第一行，判断 ID 值是不是 10，如果不是则跳过，如果是则将这行存在结果集中；
    2. 调用引擎接口取“下一行”，重复相同的判断逻辑，直到取到这个表的最后一行。
    3. 执行器将上述遍历过程中所有满足条件的行组成的记录集作为结果集返回给客户端。

    至此，这个语句就执行完成了。

​        

- 存储引擎：负责数据的存储和提取

   innodb  myisam  memory